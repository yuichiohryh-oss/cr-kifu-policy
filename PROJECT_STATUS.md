# PROJECT_STATUS.md

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**Clash Royaleï¼ˆã‚¯ãƒ©ãƒ­ãƒ¯ï¼‰ã®éŒ²ç”»å‹•ç”»ã¨æ“ä½œãƒ­ã‚°ã‹ã‚‰è¡Œå‹•ãƒ»çŠ¶æ…‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ½å‡ºã—ã€æ£‹è­œï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåˆ—ï¼‰ã¨ã—ã¦æ§‹é€ åŒ–ã—ã€å­¦ç¿’ãƒ»æ¨è«–ã«ã‚ˆã£ã¦æ¬¡ã®è¡Œå‹•ã‚’ææ¡ˆã™ã‚‹AIã‚·ã‚¹ãƒ†ãƒ **ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚

å†…éƒ¨é–‹ç™ºã§ã¯ã‚²ãƒ¼ãƒ å›ºæœ‰åè©ãƒ»UIä»•æ§˜ãƒ»æ•°å€¤ä»•æ§˜ã‚’ãã®ã¾ã¾æ‰±ã„ã€Qiita ç­‰ã®å¤–éƒ¨å…¬é–‹æ™‚ã®ã¿ä¸€èˆ¬åŒ–è¡¨ç¾ã¸å¤‰æ›ã™ã‚‹ã€‚

---

## æœ€å„ªå…ˆãƒ†ãƒ¼ãƒ

### ğŸ¯ æ£‹è­œï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåˆ—ï¼‰ä¸­å¿ƒã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

**ï¼ˆvideo.mp4 + ops.jsonl + meta.jsonï¼‰â†’ kifu.jsonl â†’ dataset.jsonl â†’ å­¦ç¿’ â†’ ææ¡ˆ** ã‚’å”¯ä¸€ã®æ­£å¼ãƒ«ãƒ¼ãƒˆã¨ã™ã‚‹ã€‚

---

## kifu.jsonl æ­£å¼ä»•æ§˜ï¼ˆv1ï¼‰

### åŸºæœ¬æ–¹é‡

* 1è¡Œ = 1ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆJSONLï¼‰
* æ™‚åˆ» `t` ã¯ **å‹•ç”»é–‹å§‹ã‹ã‚‰ã®ç§’ï¼ˆfloat, secï¼‰**
* **`seq` ã¯ run å†…ã§å˜èª¿å¢—åŠ ã™ã‚‹é€šç•ªï¼ˆ0,1,2,...)**
* ã‚½ãƒ¼ãƒˆã‚­ãƒ¼ã¯ `(t, seq)`
* **`schema_version` ã‚’å¿…é ˆ** ã¨ã—å¾Œæ–¹äº’æ›ã‚’æ‹…ä¿

### å…±é€šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¿…é ˆï¼‰

| key            | type    | å†…å®¹                           |
| -------------- | ------- | ---------------------------- |
| schema_version | string  | "kifu/1"                     |
| run_id         | string  | ã‚»ãƒƒã‚·ãƒ§ãƒ³è­˜åˆ¥å­                     |
| seq            | integer | run å†…é€šç•ªï¼ˆå˜èª¿å¢—åŠ ãƒ»ä¸€æ„ï¼‰             |
| event_id       | string  | ä¸€æ„IDï¼ˆæ¨å¥¨: `${run_id}:${seq}`ï¼‰ |
| t              | number  | å‹•ç”»é–‹å§‹ã‹ã‚‰ã®ç§’                     |
| type           | string  | action / spawn / resource    |
| actor          | string  | self / enemy / system        |
| confidence     | number  | [0,1]                        |

### action ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆPhase 1 å¿…é ˆï¼‰

| key      | type    | å¿…é ˆ | å†…å®¹                             |
| -------- | ------- | -: | ------------------------------ |
| slot     | integer |  âœ“ | æ‰‹æœ­ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ0â€“3ï¼‰                    |
| pos_grid | object  |  âœ“ | { gx:int, gy:int }             |
| pos_norm | object  | ä»»æ„ | { x:float, y:float }ï¼ˆç›¤é¢ROIæ­£è¦åŒ–ï¼‰ |
| raw      | object  | ä»»æ„ | å…ƒãƒ­ã‚°/ãƒ‡ãƒãƒƒã‚°ç”¨                      |

---

## åº§æ¨™ç³»ï¼ˆv1.3 æ˜ç¢ºåŒ–ï¼‰

### pos_normï¼ˆç›¤é¢ROIæ­£è¦åŒ–ï¼‰

* åŸºæº–: **ç›¤é¢ROI**ï¼ˆmeta.json ã® roi_boardã€‚åŸºæº–åº§æ¨™ã¯å‹•ç”»åº§æ¨™ï¼‰
* åŸç‚¹: å·¦ä¸Š (0,0)
* è»¸æ–¹å‘: xâ†’å³ã€yâ†’ä¸‹
* ç¯„å›²å¤–: clamp ã—ã¦ [0,1] ã«åã‚ã‚‹

### pos_gridï¼ˆé›¢æ•£ã‚°ãƒªãƒƒãƒ‰ï¼‰

* ç›¤é¢ROIã‚’ `gw Ã— gh` ã«ç­‰åˆ†
* åŸç‚¹: å·¦ä¸Š (0,0)
* è»¸æ–¹å‘: gxâ†’å³ã€gyâ†’ä¸‹

#### å¤‰æ›ï¼ˆpos_norm ã‹ã‚‰ï¼‰

> **ã“ã“ã§ä½¿ã† x/y ã¯ pos_normï¼ˆæ­£è¦åŒ–åº§æ¨™ï¼‰ç”±æ¥**ã€‚

* `gx = floor(x_norm * gw)`
* `gy = floor(y_norm * gh)`
* `gx = min(gx, gw-1)`, `gy = min(gy, gh-1)`

#### å¤‰æ›ï¼ˆå‹•ç”»pxâ†’pos_grid ã‚’ç›´æ¥ã‚„ã‚‹å ´åˆï¼‰

* `x_norm = clamp((x_px - roi.x1)/roi_w, 0, 1)`
* `y_norm = clamp((y_px - roi.y1)/roi_h, 0, 1)`
* ãã®å¾Œä¸Šã®å¼ã§ (gx, gy)

---

## å‹•ç”» Ã— æ“ä½œãƒ­ã‚°åŒæœŸï¼ˆv1ï¼‰

* å‹•ç”»é–‹å§‹ = t=0
* å›ºå®šã‚ªãƒ•ã‚»ãƒƒãƒˆæ–¹å¼ã®ã¿æ¡ç”¨

```
t_video = t_log + offset_sec
```

* `offset_sec` ã¯ meta.json ã«ä¿å­˜
* è¨±å®¹èª¤å·®ç›®æ¨™: Â±100msï¼ˆæœ€å¤§ Â±200msï¼‰

---

## ops.jsonlï¼ˆæ“ä½œãƒ­ã‚°ï¼‰ä»•æ§˜ï¼ˆv1ï¼‰

### æ™‚åˆ»

* `t_log` ã¯ **éŒ²ç”»é–‹å§‹ï¼ˆruné–‹å§‹ï¼‰ã‹ã‚‰ã®ç§’ï¼ˆfloat, secï¼‰**

### åº§æ¨™ç³»ï¼ˆé‡è¦ãƒ»v1ç¢ºå®šï¼‰

* `x`,`y` ã¯ **å‹•ç”»ãƒ•ãƒ¬ãƒ¼ãƒ åº§æ¨™ï¼ˆpxï¼‰**

  * åŸç‚¹: å‹•ç”»å·¦ä¸Š (0,0)
  * è»¸æ–¹å‘: xâ†’å³ã€yâ†’ä¸‹
  * ç¯„å›²: `0 <= x < video_w`, `0 <= y < video_h`

> ç«¯æœ«ç”»é¢åº§æ¨™ã‚„ scrcpy ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åº§æ¨™ã§ãƒ­ã‚°ãŒå‡ºã‚‹å ´åˆã¯ã€ãƒ­ã‚°ç”Ÿæˆå´ã§å‹•ç”»åº§æ¨™ã¸å¤‰æ›ã—ã¦ã‹ã‚‰ ops.jsonl ã«ä¿å­˜ã™ã‚‹ã€‚

### å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

| key   | type   | å†…å®¹                                            |
| ----- | ------ | --------------------------------------------- |
| t_log | number | runé–‹å§‹ã‹ã‚‰ã®ç§’                                     |
| kind  | string | tap / key / mouse_move ç­‰ï¼ˆPhase 1 ã¯ tap ã®ã¿ã§ã‚‚å¯ï¼‰ |
| x     | number | å‹•ç”»åº§æ¨™ï¼ˆpxï¼‰                                      |
| y     | number | å‹•ç”»åº§æ¨™ï¼ˆpxï¼‰                                      |

---

## meta.jsonï¼ˆãƒ©ãƒ³ãƒ¡ã‚¿æƒ…å ±ï¼‰ä»•æ§˜ï¼ˆv1ï¼‰

**meta ã¯ meta.json ã«é›†ç´„ï¼ˆå˜ä¸€ã®çœŸå®Ÿï¼‰ã€‚kifu ã® meta ã‚¤ãƒ™ãƒ³ãƒˆã¯ v1 ã§ã¯ä½¿ã‚ãªã„ã€‚**

### å¿…é ˆã‚­ãƒ¼

* run_id
* video_path
* ops_path
* video_w, video_hï¼ˆå‹•ç”»ãƒ•ãƒ¬ãƒ¼ãƒ è§£åƒåº¦ pxï¼‰
* roi_board: { x1, y1, x2, y2 }ï¼ˆç›¤é¢ROIã®pxåº§æ¨™ã€‚åŸºæº–ã¯å‹•ç”»åº§æ¨™ï¼‰
* gw, gh
* offset_sec
* fpsï¼ˆä¸æ˜ãªã‚‰ null å¯ï¼‰
* created_atï¼ˆISOæ–‡å­—åˆ—ï¼‰

---

## dataset ç”Ÿæˆï¼ˆæ–¹é‡ v1.3ï¼‰

### frames ã®æ‰±ã„ï¼ˆv1.3 ã§ç¢ºå®šï¼‰

* **frames ã¯ `runs/<run_id>/frames/` ã«ç”Ÿæˆã™ã‚‹**
* **build_dataset.py ãŒ video ã‹ã‚‰å¿…è¦ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’åˆ‡ã‚Šå‡ºã—ã¦ç”Ÿæˆã™ã‚‹**ï¼ˆäº‹å‰ç”Ÿæˆã¯ä¸è¦ï¼‰
* å‘½å: `frames/{seq:06d}.png` ã‚’æ¨å¥¨ï¼ˆdataset ã® sample_id ã¨å¯¾å¿œã—ã€å†ç¾æ€§ãŒé«˜ã„ï¼‰

### dataset.jsonl æœ€å°ã‚¹ã‚­ãƒ¼ãƒï¼ˆv1ï¼‰

| key            | type   | å¿…é ˆ | å†…å®¹                                   |
| -------------- | ------ | -: | ------------------------------------ |
| schema_version | string |  âœ“ | "dataset/1"                          |
| sample_id      | string |  âœ“ | `${run_id}:${seq}` æ¨å¥¨                |
| run_id         | string |  âœ“ | runè­˜åˆ¥å­                               |
| t_action       | number |  âœ“ | è¡Œå‹•æ™‚åˆ»ï¼ˆå‹•ç”»åŸºæº–ç§’ï¼‰                          |
| image_path     | string |  âœ“ | `runs/<run_id>/frames/{seq:06d}.png` |
| label          | object |  âœ“ | Phase1: {slot, pos_grid}             |
| meta_ref       | string | ä»»æ„ | meta.json å‚ç…§                         |

### split

* run å˜ä½ splitï¼ˆ80/10/10 ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

---

## Phase 1 åˆæ ¼åŸºæº–

* action precision â‰¥ 0.95
* action recall â‰¥ 0.90ï¼ˆåŠªåŠ›ç›®æ¨™ï¼‰
* Top-3 accuracy â‰¥ 0.60
* æœ€å°ãƒ‡ãƒ¼ã‚¿é‡: 5è©¦åˆ or 500 action
